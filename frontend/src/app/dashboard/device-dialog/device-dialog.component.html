<h1 mat-dialog-title>Add device data</h1>
<form [formGroup]="formGroup" (ngSubmit)="onSubmit(formGroup)">
    <div mat-dialog-content>
            <p>
                <mat-form-field appearance="fill">
                    <mat-label>Date</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="date">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>

                    <mat-error *ngIf="formGroup.get('date')?.hasError('required')">
                        Date is required
                    </mat-error>
                </mat-form-field>
            </p>

            <p>
                <mat-form-field appearance="fill">
                    <mat-label>Flat</mat-label>
                    <mat-select formControlName="flat">
                        <mat-option *ngFor="let flat of flats$ | async" 
                                    [value]="flat">
                            {{flat.title}}
                        </mat-option>
                    </mat-select>

                    <mat-error *ngIf="formGroup.get('flat')?.hasError('required')">
                        Flat is required
                    </mat-error>
                </mat-form-field>
            </p>

            <p>
                <mat-form-field appearance="fill">
                    <mat-label>Device</mat-label>
                    <mat-select formControlName="device">
                        <mat-option *ngFor="let device of devices$ | async" 
                                    [value]="device">
                            {{device.title}}
                        </mat-option>
                    </mat-select>

                    <mat-error *ngIf="formGroup.get('device')?.hasError('required')">
                        Device is required
                    </mat-error>
                </mat-form-field>
            </p>

            <p *ngIf="(features$ | async)?.includes('readings')">
                <mat-form-field appearance="fill">
                    <mat-label>Device reading</mat-label>
                    <input type="number" matInput formControlName="reading">
                
                    <mat-error *ngIf="formGroup.get('reading')?.hasError('pattern')">
                        Device reading should contain numbers only
                    </mat-error>
                </mat-form-field>
            </p>

            <p *ngIf="(features$ | async)?.includes('invoices')">
                <mat-form-field appearance="fill">
                    <mat-label>Invoice</mat-label>
                    <ngx-mat-file-input formControlName="invoiceFile"></ngx-mat-file-input>
                </mat-form-field>
            </p>

            <p *ngIf="(features$ | async)?.includes('receipts')">
                <mat-form-field appearance="fill">
                    <mat-label>Receipt</mat-label>
                    <ngx-mat-file-input formControlName="receiptFile"></ngx-mat-file-input>
                </mat-form-field>
            </p>
    </div>
    <div mat-dialog-actions>
        <button mat-button (click)="onCancel()" type="reset">Cancel</button>
        <button mat-button [disabled]="!formGroup.valid" type="submit">Save</button>
    </div>
</form>