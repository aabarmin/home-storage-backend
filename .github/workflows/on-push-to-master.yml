name: Build mater branch

on: 
  push:
    branches:
      - master

  workflow_dispatch:
    inputs:
      source_branch:
        description: Branch to build
        required: true
        type: string
        default: 'master'
    

jobs:
  build-frontend:
    uses: ./.github/workflows/build-frontend.yml
    with: 
      source_branch: ${{ github.ref }}
      artifact_name: frontend-${{ github.sha }}
      artifact_upload: false

  build-backend:
    uses: ./.github/workflows/build-backend.yml
    with: 
      source_branch: ${{ github.ref }}
      artifact_name: backend-${{ github.sha }}
      artifact_upload: false

  build-image-backend:
    uses: ./.github/workflows/build-image-backend.yml
    needs: build-backend
    with: 
      source_branch: ${{ github.ref }}
      docker_registry: ghcr.io
      docker_username: ${{ github.actor }}
      docker_password: ${{ github.token }}
      image_tag: backend-${{ github.sha }}